#include "unittest.hpp"
#include "controller_mpc/path_planner.h"

const double test_scale = 0.0025;
const std::string test_data = "-432.000,25105.000\n369.000,21978.000\n-2634.000,20113.000\n-5571.000,22050.000\n-8951.000,21458.000\n-9051.000,17624.000\n-4456.000,15356.000\n-3422.000,13139.000\n-1326.000,12162.000\n-2004.000,8018.000\n-4686.000,5332.000\n-7984.000,5762.000\n-6360.000,10108.000\n-5777.000,13501.000\n-10103.000,14267.000\n-12399.000,9573.000\n-14768.000,8884.000\n-15975.000,10085.000\n-13981.000,12918.000\n-13378.000,15714.000\n-13934.000,18535.000\n-17565.000,20527.000\n-19545.000,22525.000\n-18134.000,24751.000\n-12959.000,23080.000\n-10419.000,24898.000\n-11654.000,27816.000\n-13287.000,30324.000\n-15080.000,33211.000\n-16563.000,36746.000\n-16174.000,39635.000\n-13398.000,40445.000\n-10227.000,40000.000\n-6835.000,39460.000\n-6643.000,33503.000\n-2985.000,33003.000\n-2239.000,37010.000\n234.000,37397.000\n3143.000,36732.000\n5083.000,36062.000\n7314.000,35321.000\n9885.000,34234.000\n12010.000,33204.000\n14905.000,30727.000\n15267.000,28862.000\n14634.000,27093.000\n13534.000,25188.000\n11781.000,24865.000\n10574.000,26700.000\n10443.000,29648.000\n7243.000,30504.000\n5773.000,33551.000\n2374.000,33081.000\n1438.000,28193.000\n-33.000,26699.000\n-202.000,25805.000\n-432.000,25105.000";

class Test_Planner : public UnitTest {
public:
    void run() {
        testInfo("Testing planner...");

        std::string testdata_filename = "__test_path_data.txt";
        testInfo("Writing test data to " + testdata_filename);

        FILE *f = fopen(testdata_filename.c_str(), "wt");
        fprintf(f, "%s", test_data.c_str());
        fclose(f);

        PathPlanner::Planner planner;
        planner.loadPath(testdata_filename, test_scale);
        planner.runTests();

        testPass("Planner");
    }
};